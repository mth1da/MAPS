{% extends 'base.html.twig' %}

{% block title %}Votre panier{% endblock %}

{% block body %}
<section class="bg-light p-3">
    <h1>Votre panier</h1>
</section>
    <main class="container">
        {% if app.user %}
            {% if panier %}
                <a href="{{ path('app_sandwich') }}" class="btn btn-info">Continuer mes achats</a></p>
                <table class="table">
                    <thead>
                    <tr>
                        <th>Produit</th>
                        <th>Prix</th>
                        <th>Quantité</th>
                        <th>Total</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for key, element in panier  %}
                        {% if element is iterable%}
                            <tr>
                                <td>Sandwich {{ key + 1 }}</td>
                                <td> {{ element['totalIngBySandwich'] }}</td>
                                <td> {{ element['totalQte'] }}</td>
                                <td> {{ element['totalIngBySandwichByQte'] }}</td>
                            </tr>
                            {% for ingredient in element %}
                                {% if ingredient.ingredient is defined %}
                                    <tr>
                                    <td>{{ ingredient.ingredient.name }}</td>
                                    <td>{{ ingredient.ingredient.price/100 }}</td>
                                    <td>{{ ingredient.quantite }}</td>
                                    <td>{{ ingredient.ingredient.price * ingredient.quantite /100}}</td>
                                {% endif %}
                            {% endfor %}
                            <td>
                                <a href="{{ path('app_cart_duplicate_maps', {index: key}) }}" class="btn btn-success">Ajouter</a>
                                <a href="{{ path('app_cart_remove_maps', {index: key}) }}" class="btn btn-danger">Supprimer</a>
                            </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                    {% for element in dataPanier %}
                    <tr>
                        {% if element.sandwich is defined %}
                        {% if element.sandwich is not null %}
                            <td>{{ element.sandwich.Name }}</td>
                            <td>{{ element.sandwich.price }} €</td>
                            <td>{{ element.quantite }}</td>
                            <td>{{ element.quantite * element.sandwich.price }} €</td>
                            <td>
                                <a href="{{path("addOriginal", {id: element.sandwich.id})}}" class="btn btn-success">Ajouter</a>
                                <a href="{{path("removeOriginal", {id: element.sandwich.id})}}" class="btn btn-danger">Supprimer</a>
                            </td>
                        {% endif %}
                        {% endif %}
                    </tr>
                    {% endfor %}
                    </tbody>
                    <tfoot>
                    <tr>
                        <td colspan="3">Total</td>
                        <td class="text-end">{{ total }} €</td>
                    </tr>
                    </tfoot>
                </table>
                <button class="btn btn-danger" onclick="location.href='{{ path('delete') }}'">Vider le panier</button>
                <button class="btn btn-primary ">Commander</button>
            {% else %}
                <p>Votre panier est vide
                    <a href="{{ path('app_sandwich') }}" class="btn btn-info">Commencer mes achats</a>
                </p>
            {% endif %}
        {% else %}
            <p>Connectez-vous pour accéder à votre panier !</p>
            <a href="{{ path("app_login") }}" class="btn btn-secondary">Me connecter</a>
        {% endif %}

        {{ dump(panier) }}
    </main>
{% endblock %}